<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DermaScope AI</title>

  <style>
    :root{
      --bg: #0b1220; /* dark background */
      --card: #0f1724; /* card background */
      --muted: #94a3b8;
      --accent: #06b6d4; /* cyan */
      --accent-600: #0891b2;
      --accent-100: rgba(6,182,212,0.08);
      --text: #e6eef6;
      --radius: 10px;
      --max-width: 920px;
      --shadow: 0 8px 30px rgba(2,6,23,0.6);
    }

    html,body{height:100%}
    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
                   Roboto, "Helvetica Neue", Arial;
      margin: 20px;
      background: linear-gradient(180deg, #071021, #071422);
      color: var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }

    .wrap { max-width: var(--max-width); margin: 0 auto; padding: 18px; }
    header { display:flex; flex-direction:column; gap:8px; margin-bottom:18px; }
    h1 { margin:0; font-size:1.6rem; letter-spacing: -0.02em; }
    .subheader { margin:0; color:var(--muted); font-weight:600; font-size:0.95rem; }
    .top-row { display:flex; justify-content:space-between; gap:12px; align-items:center; }

    .card {
      background:var(--card);
      border-radius:var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
      border:1px solid rgba(255,255,255,0.03);
    }

    .controls { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:10px 0 14px 0; }
    button {
      padding:8px 12px; border-radius:8px; border:0; background:var(--accent);
      color:#042027; cursor:pointer; font-weight:700;
      box-shadow: 0 6px 14px rgba(6,182,212,0.08);
    }
    button.ghost { background: transparent; color: var(--accent-600); border: 1px solid rgba(6,182,212,0.12); box-shadow:none; }

    .controls input[type=file] { padding:6px; background:transparent; color:var(--text); }

    #webcam-container { display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap; margin-top:6px; }
    video, canvas, img { border-radius:8px; border:1px solid rgba(255,255,255,0.03); box-shadow: 0 6px 18px rgba(2,6,23,0.3); max-width:100%; background:#03060a; }
    .preview { width:360px; max-width:100%; }

    .results { margin-top:12px; }
    .result-item { display:flex; justify-content:space-between; gap:12px; padding:8px 10px; border-radius:8px; background:var(--accent-100); margin-bottom:8px; align-items:center; }
    .result-name { font-weight:700; color:var(--text); }
    .progress { width:160px; height:10px; background:rgba(255,255,255,0.04); border-radius:8px; overflow:hidden; }
    .bar { height:100%; background:linear-gradient(90deg,var(--accent) , var(--accent-600)); }

    #status { font-size:0.95rem; color:var(--muted); }

    footer { margin-top:18px; color:var(--muted); font-size:0.9rem; }

    /* Responsive */
    @media (max-width:720px){
      .top-row{ flex-direction:column; align-items:flex-start; gap:6px;}
      .preview { width:100%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card">
      <div class="top-row">
        <div>
          <h1>DermaScope AI</h1>
          <div class="subheader">Personal Project — MYP</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:600;color:var(--text);">By: Devyani Shekhawat</div>
          <div id="status">Loading...</div>
          <small style="color:var(--muted)">Model: q1DzKFBRt</small>
        </div>
      </div>

      <p style="margin-top:12px;color:var(--muted)">
        I’m Devyani, a high school student passionate about AI and healthcare. I built DermaScope AI to explore how machine learning can help identify common dermatological conditions like acne, eczema, and benign moles. This project was created as part of my MYP personal project — it’s a learning experiment, not a medical diagnostic tool. If you try it, please don’t use the results as medical advice. If you have questions or feedback, I’d love to hear from you!
      </p>
    </header>

    <div class="card" style="margin-top:12px">
      <div class="controls">
        <button id="webcam-btn">Start Webcam</button>
        <button id="snap-btn" class="ghost" title="Capture frame when webcam running">Snap</button>
        <label style="display:flex;align-items:center;gap:8px;">
          Upload an image:
          <input id="image-input" type="file" accept="image/*">
        </label>
        <div style="flex:1"></div>
        <button id="theme-btn" class="ghost" title="Cycle accent color">Change Accent</button>
      </div>

      <div id="webcam-container">
        <video id="webcam" autoplay playsinline class="preview" style="display:none;" width="360" height="270"></video>
        <canvas id="webcam-canvas" width="360" height="270" class="preview" style="display:none;"></canvas>
        <img id="uploaded-img" alt="" class="preview" style="display:none;">
      </div>

      <div class="results" id="results-area">
        <h3 style="margin:12px 0 8px 0">Predictions</h3>
        <div id="pred-list"></div>
      </div>
    </div>

    <footer>
      Tip: GitHub Pages provides HTTPS (required for camera). If model fails to load, export the model and host model files on this repo to avoid CORS issues.
    </footer>
  </div>

  <!-- TensorFlow.js (must load first) -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
  <!-- Teachable Machine image library (depends on tf) -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <script>
    // CONFIG / QUICK EDITS
    const MODEL_URL = "https://teachablemachine.withgoogle.com/models/q1DzKFBRt/"; // your model
    const WEBCAM_WIDTH = 360;
    const WEBCAM_HEIGHT = 270;
    const AUTO_START_WEBCAM = false; // set true to auto-start camera on load
    const SHOW_TOP_ONLY = false;     // set true to show only top prediction

    // elements
    const statusEl = document.getElementById('status');
    const webcamBtn = document.getElementById('webcam-btn');
    const snapBtn = document.getElementById('snap-btn');
    const themeBtn = document.getElementById('theme-btn');
    const imageInput = document.getElementById('image-input');
    const webcamVideo = document.getElementById('webcam');
    const webcamCanvas = document.getElementById('webcam-canvas');
    const uploadedImg = document.getElementById('uploaded-img');
    const predList = document.getElementById('pred-list');

    let model, maxPredictions;
    let webcam; // tmImage Webcam instance
    let isWebcamOn = false;
    let rafId;

    async function init() {
      if (!MODEL_URL || MODEL_URL.includes("PASTE_YOUR_MODEL")) {
        statusEl.innerText = "Model URL missing — set MODEL_URL in the script.";
        return;
      }

      try {
        statusEl.innerText = "Loading model...";
        const modelJSON = MODEL_URL + "model.json";
        const metadataJSON = MODEL_URL + "metadata.json";
        model = await tmImage.load(modelJSON, metadataJSON);
        maxPredictions = model.getTotalClasses();
        statusEl.innerText = "Model loaded.";
        if (AUTO_START_WEBCAM) startWebcam();
      } catch (err) {
        console.error(err);
        statusEl.innerText = "Failed to load model. Check the URL and CORS. See console for details.";
      }
    }

    async function startWebcam() {
      if (!model) { statusEl.innerText = "Model not loaded."; return; }
      if (isWebcamOn) return stopWebcam();

      try {
        const flip = true; // mirror user-facing camera
        webcam = new tmImage.Webcam(WEBCAM_WIDTH, WEBCAM_HEIGHT, flip);
        await webcam.setup(); // request permission
        await webcam.play();
        webcamVideo.style.display = 'block';
        webcamCanvas.style.display = 'none';
        uploadedImg.style.display = 'none';
        const container = document.getElementById('webcam-container');
        if (container.contains(webcamVideo)) container.replaceChild(webcam.canvas, webcamVideo);
        isWebcamOn = true;
        webcamBtn.innerText = 'Stop Webcam';
        statusEl.innerText = 'Webcam running — classifying...';
        loop();
      } catch (err) {
        console.error(err);
        statusEl.innerText = "Webcam error: " + (err.message || err);
      }
    }

    function stopWebcam() {
      if (!webcam) return;
      cancelAnimationFrame(rafId);
      webcam.stop();
      isWebcamOn = false;
      webcamBtn.innerText = 'Start Webcam';
      statusEl.innerText = 'Webcam stopped.';
      const container = document.getElementById('webcam-container');
      if (container.contains(webcam.canvas)) {
        container.replaceChild(webcamVideo, webcam.canvas);
        webcamVideo.style.display = 'none';
      }
    }

    async function loop() {
      webcam.update(); // update the webcam frame
      await predict(webcam.canvas);
      rafId = requestAnimationFrame(loop);
    }

    async function predict(imgOrCanvas) {
      if (!model) return;
      const prediction = await model.predict(imgOrCanvas);
      updatePredictions(prediction);
    }

    function updatePredictions(predictions) {
      const sorted = [...predictions].sort((a,b) => b.probability - a.probability);
      predList.innerHTML = '';
      const toShow = SHOW_TOP_ONLY ? [sorted[0]] : sorted;
      toShow.forEach(p => {
        const item = document.createElement('div');
        item.className = 'result-item';
        const left = document.createElement('div');
        left.innerHTML = `<div class=\"result-name\">${escapeHtml(p.className)}</div>`;
        const right = document.createElement('div');
        right.style.display = 'flex';
        right.style.alignItems = 'center';
        right.style.gap = '8px';
        const progress = document.createElement('div');
        progress.className = 'progress';
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.width = Math.round(p.probability*100) + '%';
        progress.appendChild(bar);
        const percent = document.createElement('div');
        percent.textContent = Math.round(p.probability*100) + '%';
        right.appendChild(progress);
        right.appendChild(percent);
        item.appendChild(left);
        item.appendChild(right);
        predList.appendChild(item);
      });
    }

    // Handle file uploads
    imageInput.addEventListener('change', async (ev) => {
      const file = ev.target.files && ev.target.files[0];
      if (!file) return;
      stopWebcam();
      const url = createObjectURL(file);
      uploadedImg.src = url;
      uploadedImg.onload = async () => {
        uploadedImg.style.display = 'block';
        try {
          await predict(uploadedImg);
          statusEl.innerText = 'Classified uploaded image.';
        } catch (err) {
          console.error(err);
          statusEl.innerText = 'Error classifying image.';
        }
        try { (window.URL || window.webkitURL).revokeObjectURL(url); } catch(e){}
      };
    });

    // Snap a still from webcam into canvas and classify that frame
    snapBtn.addEventListener('click', async () => {
      if (!isWebcamOn || !webcam) return;
      const canvas = webcam.canvas;
      // show canvas preview (optional)
      const container = document.getElementById('webcam-container');
      if (container.contains(webcam.canvas)) {
        // ensure canvas is visible
        webcam.canvas.style.display = 'block';
      }
      try {
        await predict(canvas);
        statusEl.innerText = 'Snapped frame classified.';
      } catch (err) {
        console.error(err);
        statusEl.innerText = 'Error classifying snapped frame.';
      }
    });

    webcamBtn.addEventListener('click', () => {
      if (isWebcamOn) stopWebcam(); else startWebcam();
    });

    // simple accent color cycle for demo
    const ACCENTS = ['#06b6d4','#8b5cf6','#f87171','#06b6d4','#f59e0b'];
    let accentIndex = 0;
    themeBtn.addEventListener('click', () => {
      accentIndex = (accentIndex + 1) % ACCENTS.length;
      document.documentElement.style.setProperty('--accent', ACCENTS[accentIndex]);
      document.documentElement.style.setProperty('--accent-600', ACCENTS[accentIndex]);
    });

    // helpers
    function escapeHtml(text) {
      return String(text).replace(/[&<>\"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":"&#39;"}[m]));
    }
    function createObjectURL(file) {
      return (window.URL || window.webkitURL).createObjectURL(file);
    }

    // Start
    window.addEventListener('load', init);
  </script>
</body>
</html>
